(()=>{"use strict";var e={d:(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{a:()=>z,S:()=>W});const t=e=>{let t=JSON.stringify(e);t=JSON.parse(t),t.isPlaying=!1,t.isSeeking=!1,t.random=!1,t.repeat=!1,localStorage.setItem("state",JSON.stringify(t))},n=()=>a().get("All Music"),l=e=>{let t=JSON.stringify(Array.from(e.entries()));localStorage.setItem("playListsState",t)},a=()=>{let e=localStorage.getItem("playListsState");return new Map(JSON.parse(e))},i="myDatabase",r=document.getElementById("musicPlaying"),s=document.getElementById("playStopBtn"),o=document.getElementById("playIcon"),c=document.getElementById("stopIcon"),d=document.querySelector(".player-progress"),u=document.querySelector(".player-progress-filled"),m=document.querySelector(".player-time-current"),y=document.querySelector(".player-time-duration"),p=document.getElementById("volume"),g=document.getElementById("playlist"),h=document.getElementById("randomPlay"),f=document.getElementById("repeatPlay"),L=document.getElementById("nextBtn"),v=document.getElementById("prevBtn"),I=document.getElementById("playlistsList"),E=document.getElementById("playerName"),x=document.getElementById("modal"),k=document.getElementById("addPlaylist"),B=document.getElementById("choiceTrack"),b=document.getElementById("newBtn"),S=document.getElementById("closeBtn"),T=document.getElementById("headerCloseBtn"),A=document.getElementById("newPlaylistName"),M=document.getElementById("inputError"),w=new Audio,C=new(window.AudioContext||window.webkitAudioContext),N=C.createAnalyser();N.fftSize=4096;const P=C.createMediaElementSource(w),$=()=>{W.isPlaying?w.pause():w.play(),"suspended"===C.state&&C.resume(),W.isPlaying=!W.isPlaying,D()},D=()=>{W.isPlaying?(o.classList.add("hidden"),c.classList.remove("hidden")):(o.classList.remove("hidden"),c.classList.add("hidden"))},O=()=>{if(1!=W.repeat){if(1==W.random){let e=Math.floor(Math.random()*W.playlist.length);return W.currentTrackIndex=e,void R(W.currentTrackIndex)}W.currentTrackIndex<W.playlist.length-1?W.currentTrackIndex++:W.currentTrackIndex=0,R(W.currentTrackIndex)}else R(W.currentTrackIndex)},q=()=>{const e=w.currentTime/w.duration*100;u.style.width=`${e}%`},J=e=>{const t=d.getBoundingClientRect(),n=(e.clientX-t.left)/t.width*w.duration;w.currentTime=n,q()},_=e=>{g.innerHTML="",z.get(e).forEach(((t,n)=>{let l=document.createElement("li");n==W.currentTrackIndex&&e==W.playlistName?l.classList="playlist_list-item playing":l.classList="playlist_list-item",Array.isArray(t)?l.textContent=`${n+1}. ${t[0]}`:l.textContent=`${n+1}. ${t.slice(0,-4)}`,l.addEventListener("click",(()=>{W.playlistName=e,W.playlist=z.get(e),console.log(e),$(),C.resume(),R(n)})),g.appendChild(l)}))},R=e=>{let n=g.querySelectorAll(".playlist_list-item");if(n)for(let t=0;t<=n.length-1;t++){let l=n[t];t==e?l.classList.add("playing"):l.classList.remove("playing")}var l,a;W.currentTrackIndex=e,t(W),Array.isArray(W.playlist[e])?(l=W.playlist[e][0],a=function(t){if(t){const n=URL.createObjectURL(t);if(w.src=n,r.textContent=W.playlist[e][0],w.load(),w.play(),"suspended"===C.state)return;W.isPlaying=!0,D()}else console.error("Blob not found in IndexedDB")},indexedDB.open(i,1).onsuccess=function(e){const t=e.target.result.transaction(["blobs"],"readonly").objectStore("blobs").get(l);t.onsuccess=function(){const e=t.result;if(e){const t=e.blob;console.log(`Blob retrieved from IndexedDB with name: ${l}`),a(t)}else console.error(`Blob not found in IndexedDB with name: ${l}`),a(null)},t.onerror=function(){console.error("Error getting Blob from IndexedDB"),a(null)}}):(w.src=`../audio/${W.playlist[e]}`,r.textContent=W.playlist[e].slice(0,-4),w.load(),w.play()),"suspended"!==C.state&&(W.isPlaying=!0,D())},j=()=>{A.value="",x.classList.toggle("hidden")},H=()=>{I.innerHTML="";for(let[e,n]of z.entries()){const n=()=>{let t=I.querySelectorAll("li");for(let n=0;n<=t.length-1;n++)t[n].getAttribute("name")==e?t[n].classList="playlist_item playing":t[n].classList="playlist_item";E.textContent=e,_(e)};let a=document.createElement("li");W.playlistName==e?a.classList="playlist_item playing":a.classList="playlist_item",E.textContent=W.playlistName,a.setAttribute("name",e);let i=document.createElement("span");i.classList="playlist_name-txt",i.textContent=e;let r=document.createElement("button");r.textContent="x",r.classList="delete_button",r.addEventListener("click",(e=>{a.removeEventListener("click",n);let i=e.target.parentNode,r=i.getAttribute("name");i.parentNode.removeChild(i),W.currentTrackIndex=U(W.playlist[W.currentTrackIndex]),z.delete(r),l(z),W.playlistName="All Music",W.playlist=z.get("All Music"),E.textContent="All Music",t(W),_("All Music"),H()})),a.append(i),"All Music"!==e&&a.append(r),a.addEventListener("click",n),I.append(a)}},U=e=>{let t=e;Array.isArray(e)&&(t=e[0]);let l=n();for(let e=0;e<=l.length-1;e++){if(Array.isArray(l[e])&&l[e][0]==t)return e;if(l[e]==t)return e}};f.addEventListener("click",(()=>{if(1==W.repeat)return f.classList.remove("active"),void(W.repeat=!1);W.repeat=!0,W.random=!1,f.classList.add("active"),h.classList.remove("active")})),h.addEventListener("click",(()=>{if(1==W.random)return h.classList.remove("active"),void(W.random=!1);W.random=!0,W.repeat=!1,h.classList.add("active"),f.classList.remove("active")})),L.addEventListener("click",O),v.addEventListener("click",(()=>{if(1!=W.repeat){if(1==W.random){let e=Math.floor(Math.random()*W.playlist.length);return W.currentTrackIndex=e,void R(W.currentTrackIndex)}W.currentTrackIndex>0?W.currentTrackIndex--:W.currentTrackIndex=W.playlist.length-1,R(W.currentTrackIndex)}else R(W.currentTrackIndex)})),w.addEventListener("timeupdate",(()=>{(()=>{const e=Math.floor(w.currentTime),t=Math.floor(e/60),n=e%60;m.textContent=`${t}:${n<10?"0":""}${n}`})(),q()})),w.addEventListener("durationchange",(()=>{const e=Math.floor(w.duration),t=Math.floor(e/60),n=e%60;y.textContent=`${t}:${n<10?"0":""}${n}`})),w.addEventListener("ended",(()=>{W.isSeeking||O()})),s.addEventListener("click",$),p.addEventListener("input",(()=>{w.volume=p.value})),d.addEventListener("mousedown",(e=>{1==W.isPlaying&&(o.classList.remove("hidden"),c.classList.add("hidden"),w.pause()),W.isSeeking=!0,J(e)})),window.addEventListener("mousemove",(e=>{W.isSeeking&&J(e)})),window.addEventListener("mouseup",(()=>{1==W.isPlaying&&(D(),W.isSeeking=!1,w.play()),W.isSeeking=!1})),k.addEventListener("click",(()=>{x.classList.contains("hidden")&&(B.innerHTML="",n().forEach(((e,t)=>{let n=document.createElement("label");W.currentTrackIndex,n.classList="track_list-item",2==e.length?n.innerHTML=`<input type="checkbox" name="choiceTrack">${e[0]}`:n.innerHTML=`<input type="checkbox" name="choiceTrack">${e.slice(0,-4)}`,B.appendChild(n)}))),A.value="",M.textContent="",x.classList.toggle("hidden")})),T.addEventListener("click",j),S.addEventListener("click",j),b.addEventListener("click",(()=>{let e=A.value.trim();if(""==e)return void(M.textContent="Заполните поле");if(z.has(e))return void(M.textContent="Плейлист существует");let t=A.value.trim(),a=B.querySelectorAll('[name*="choiceTrack"]'),i=n(),r=[];for(let e=0;e<=i.length-1;e++)a[e].checked&&r.push(i[e]);0!=r.length?(M.textContent="",z.set(t,r),l(z),H(),j()):M.textContent="Выберите треки"}));const F=document.getElementById("fileInput");let W={currentTrackIndex:0,isPlaying:!1,isSeeking:!1,random:!1,repeat:!1,playlist:[],playlistName:"All Music"},z=new Map;z.set("All Music",["Xxxtentacion Joey Bada — infinity888.mp3","Linkin Park — Burn It Down.mp3","Rucci — THAT'S NORF, PT. 2 (feat. Foe & Bueno Da Champ).mp3","Madcon — Beggin.mp3","Kiss — I Was Made For Lovin You.mp3","DJ JACOB — Midnight Club.mp3","SAY3AM — JUDAS.mp3","Eddie Murphy — Part All The Time.mp3","Logic feat. Wiz Khalifa — Indica Badu.mp3","Travis Scott feat. Drake — MELTDOWN.mp3"]),null!==localStorage.getItem("state")&&(W=JSON.parse(localStorage.getItem("state"))),null!==localStorage.getItem("playListsState")?(z=a(),W.playlist=z.get(W.playlistName)):(W.playlist=z.get("All Music"),l(z)),F.addEventListener("change",(e=>{const a=e.target.files[0];if(a){const e=new Blob([a],{type:a.type}),r=URL.createObjectURL(e);((e,t,n)=>{const l=indexedDB.open(i,1);l.onupgradeneeded=function(e){const t=e.target.result;t.objectStoreNames.contains("blobs")||t.createObjectStore("blobs",{keyPath:"name"})},l.onsuccess=function(n){const l=n.target.result.transaction(["blobs"],"readwrite").objectStore("blobs").put({name:e,blob:t});l.onsuccess=function(){console.log(`Blob saved to IndexedDB with name: ${e}`)},l.onerror=function(){console.error("Error saving Blob to IndexedDB")}}})(a.name.slice(0,-4),e);let s=n();s.push([a.name.slice(0,-4),r]),z.set("All Music",s),"All Music"==W.playlistName&&(W.playlist=s),t(W),l(z),_(W.playlistName)}})),_(W.playlistName),H(),R(W.currentTrackIndex),function e(){const t=document.getElementById("visualizer");t.width=t.offsetWidth,t.height=t.offsetHeight;let n=t.getContext("2d");P.connect(N),N.connect(C.destination);let l=new Uint8Array(N.frequencyBinCount);N.getByteFrequencyData(l),n.clearRect(0,0,t.width,t.height);const a=t.width/l.length*2.5;let i,r=0;for(let e=0;e<l.length;e++)i=l[e],n.fillStyle="rgb(256, 256, 256)",n.fillRect(r,t.height-i/2,a,i),r+=a+1;requestAnimationFrame(e)}()})();